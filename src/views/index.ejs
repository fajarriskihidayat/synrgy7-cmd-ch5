<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Car Management Dashboard</title>

    <!-- External CSS -->
    <link rel="stylesheet" href="../../assets/css/style.css" />

    <!-- Bootstrap CSS -->
    <!-- CSS only -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
  </head>

  <body>
    <div id="myContainer" class="container-fluid">
      <div id="navbar-left" class="left-side">
        <div class="logo-left">
          <img src="../../assets/images/logo-left-side.png" />
        </div>
        <div class="btn-home">
          <button type="button" class="btn cstm-btn-home">
            <img src="../../assets/images/home.png" />
            Dashboard
          </button>
        </div>
        <div class="btn-truck">
          <button type="button" class="btn cstm-btn-truck">
            <img src="../../assets/images/truck.png" /><br />
            Cars
          </button>
        </div>
      </div>
      <div class="right-side">
        <div id="navbar-top">
          <div class="logo-top">
            <img src="../../assets/images/logo-top-side.png" />
          </div>
          <div class="icon-menu">
            <img src="../../assets/images/menu.png" />
          </div>
          <div class="input-group search">
            <span class="input-group-text"
              ><img src="../../assets/images/search.png"
            /></span>
            <input
              type="text"
              class="form-control cstm-form-ctrl"
              placeholder="Username"
              aria-label="Username"
            />
            <button type="button" class="btn cstm-btn-search">Search</button>
          </div>
          <div class="profile">
            <img
              src="../../assets/images/gambar_profile.png"
              class="picture_profile"
            />
            <p class="username">Unis Badri</p>
            <img src="../../assets/images/arrow_down.png" class="icon_arrow" />
          </div>
        </div>
        <div class="container-content">
          <div class="left-side-content">
            <div class="title">
              <p>CARS</p>
            </div>
            <div class="category">
              <p>List Car</p>
            </div>
          </div>
          <div class="right-side-content">
            <div class="list_page">
              <nav
                style="
                  --bs-breadcrumb-divider: url(
                    &#34;data:image/svg + xml,
                    %3Csvgxmlns='http://www.w3.org/2000/svg'width='8'height='8'%3E%3Cpathd='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z'fill='currentColor'/%3E%3C/svg%3E&#34;
                  );
                "
                aria-label="breadcrumb"
              >
                <ol class="breadcrumb">
                  <li class="breadcrumb-item">
                    <a class="link_home" href="/">Home</a>
                  </li>
                  <li
                    class="breadcrumb-item active link_active"
                    aria-current="page"
                  >
                    List Car
                  </li>
                </ol>
              </nav>
            </div>
            <div class="add_new_car">
              <div class="title-add">
                <p>List Car</p>
              </div>
              <div class="btn-add-car">
                <a href="/addCar">
                  <button type="button" class="btn">
                    <img src="../../assets/images/plus.png" />
                    Add New Car
                  </button>
                </a>
              </div>
            </div>
            <div class="filter">
              <div class="btn-all">
                <button type="button" class="btn btn-filter-active">All</button>
              </div>
              <div class="btn-small">
                <button type="button" class="btn btn-filter">Small</button>
              </div>
              <div class="btn-medium">
                <button type="button" class="btn btn-filter">Medium</button>
              </div>
              <div class="btn-large">
                <button type="button" class="btn btn-filter">Large</button>
              </div>
            </div>
            <div class="item-car gap-3">
              <% cars.forEach((data, i) => { %>
              <div class="card">
                <img src="<%=data.img_url %>" class="card-img-top" />
                <div class="card-body">
                  <p class="card-name-car"><%= data.name %></p>
                  <p class="card-price">Rp <%= data.rentPerDay %> / hari</p>
                  <div class="info-car">
                    <img src="../../assets/images/clock.png" />
                    <p class="card-text">
                      Updated at <%= String(data.updatedAt).substring(8,10) +
                      "-" + String(data.updatedAt).substring(4,7) + "-" +
                      String(data.updatedAt).substring(11,15) %>
                    </p>
                  </div>
                  <div class="btn-card">
                    <div class="cstm-btn-delete">
                      <button
                        type="button"
                        class="btn btn-delete deleteBtn"
                        data-bs-toggle="modal"
                        data-bs-target="#staticBackdrop"
                        data-id-car="<%= data.id %>"
                      >
                        <img src="../../assets/images/trash.png" />
                        Delete
                      </button>

                      <div
                        class="modal fade"
                        id="staticBackdrop"
                        data-bs-backdrop="static"
                        data-bs-keyboard="false"
                        tabindex="-1"
                        aria-labelledby="staticBackdropLabel"
                        aria-hidden="true"
                      >
                        <div class="modal-dialog modal-dialog-centered">
                          <div class="modal-content">
                            <div class="logo-modal">
                              <img src="../../assets/images/pic_delete.png" />
                            </div>
                            <div class="title-modal">
                              <h5>Menghapus Data Mobil</h5>
                            </div>
                            <div class="ket-modal">
                              <p>
                                Setelah dihapus, data mobil tidak dapat<br />
                                dikembalikan. Yakin ingin menghapus?
                              </p>
                            </div>
                            <div class="modal-footer">
                              <button
                                type="button"
                                class="btn btn-yes yesBtn"
                                data-bs-dismiss="modal"
                              >
                                Ya
                              </button>
                              <a href="/" class="btn btn-no" role="Button"
                                >Tidak</a
                              >
                            </div>
                          </div>
                        </div>
                      </div>
                      <a href="/editCar/<%= data.id %>" class="btn btn-edit">
                        <img src="../../assets/images/edit.png" />
                        Edit
                      </a>
                    </div>
                  </div>
                </div>
              </div>
              <% }) %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- External JS -->
    <script src="../../assets/assets/js/index.js"></script>

    <!-- Bootstrap JS -->
    <!-- JavaScript Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <script>
      document.addEventListener("DOMContentLoaded", (event) => {
        const deleteButtons = document.querySelectorAll(".deleteBtn");
        let carIdToDelete;

        deleteButtons.forEach((button) => {
          button.addEventListener("click", function () {
            carIdToDelete = this.getAttribute("data-id-car");
          });
        });

        const yesButton = document.querySelector(".yesBtn");
        yesButton.addEventListener("click", function () {
          if (carIdToDelete) {
            fetch(`/api/cars/delete/${carIdToDelete}`, {
              method: "DELETE",
            })
              .then((response) => {
                location.reload();
              })
              .catch((error) => {
                console.error("Error:", error);
                alert("An error occurred");
              });
          }
        });
      });
    </script>
  </body>
</html>
